<! python3 -m http.server>

<!DOCTYPE html>
<meta charset="utf-8">
<link rel="stylesheet" href="style.css" charset="utf-8">

<!-- Load d3.js -->
<script src="https://d3js.org/d3.v4.js"></script>

<!-- Create a div where the graph will take place -->
<div id="my_dataviz"></div>


<script lang="javascript">

    var w = window,
        d = document,
        e = d.documentElement,
        g = d.getElementsByTagName('body')[0],
        x = w.innerWidth || e.clientWidth || g.clientWidth,
        y = w.innerHeight|| e.clientHeight|| g.clientHeight,
        //svg_dims = {width: x - svg_margin.left - svg_margin.right,
        //            height: y - svg_margin.top - svg_margin.bottom},
        svg_dims = {width: x - 100,
                    height: y - 100},
        svg_margin = {top: 5, bottom: 0, left: 5, right: 0},
        plot_margin = {top: 100, bottom: 100, left: 50, right: 50},
        plot_dims = {width: svg_dims.width - plot_margin.left - plot_margin.right,
                     height: svg_dims.height - plot_margin.top - plot_margin.bottom};

    // append the svg object to the body of the page
    var svg = d3.select("#my_dataviz")
          .append("svg")
            .attr("width", svg_dims.width)
            .attr("height", svg_dims.height)
            .attr("transform", "translate(" + svg_margin.left + "," + svg_margin.top + ")");

 
    svg.append("rect")
        .attr("width", "100%")
        .attr("height", "100%")
        .attr("fill", "pink");
    
    axes = svg.append("g")
        .attr("width", plot_dims.width)
        .attr("height", plot_dims.height)
        .attr("transform", "translate(" + plot_margin.left + "," + (plot_margin.top) + ")");

    axes.append("rect")
        .attr("width", plot_dims.width)
        .attr("height", plot_dims.height)
        .attr("fill", "grey");

    var clip = axes.append("defs").append("svg:clipPath")
        .attr("id", "clip")
        .append("svg:rect")
        .attr("id", "clip-rect")
        .attr("x", "0")
        .attr("y", "0")
        .attr('width', plot_dims.width)
        .attr('height', plot_dims.height);

      // Add X axis
      var x_scale = d3.scaleLinear()
        .domain([40000, 60000])
        .range([ 0, plot_dims.width ]);
      var xAxis = d3.axisBottom(x_scale);
      var x_axis = svg.append("g")
        .attr("transform", "translate(" + plot_margin.left + "," + (plot_dims.height + plot_margin.top) + ")")
        .call(xAxis);

      // Add Y axis
      var y_scale = d3.scaleLinear()
        .domain([40000, 95000])
        .range([ plot_dims.height, 0]);
      var yAxis = d3.axisLeft(y_scale);
      var y_axis = svg.append("g")
        .attr("transform", "translate(" + plot_margin.left + "," + plot_margin.top + ")")
        .call(yAxis);


    //Read the data
    d3.csv("temp_us_data.csv", function(data) {

      // Add dots
      var scatter = axes.append('g')
        .attr("clip-path", "url(#clip)")
        .selectAll(".dot")
        .attr("class", "dot")
        .data(data)
        .enter()
        .append("circle")
          .attr("cx", function (d) { return x_scale(d.deaths_2019_all_ages); } )
          .attr("cy", function (d) { return y_scale(d.deaths_2020_all_ages); } )
          .attr("r", 5.5)
          .style("fill", "#69b3a2");

    var zoom = d3.zoom()
      .on("zoom", zoomed);
    svg.call(zoom);
     function zoomed() {

           var new_x_scale = d3.event.transform.rescaleX(x_scale);
           var new_y_scale = d3.event.transform.rescaleY(y_scale);

           x_axis.transition()
             .duration(0)
             .call(xAxis.scale(new_x_scale));

           y_axis.transition()
             .duration(0)
             .call(yAxis.scale(new_y_scale));

          scatter
             .attr("cx", function(d) {
                           return new_x_scale(d.deaths_2019_all_ages)
                         })
             .attr("cy", function(d) {
                           return new_y_scale(d.deaths_2020_all_ages)
                         });
         }



    })

</script>
